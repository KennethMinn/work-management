import{d as F,r as Q,j as e,B as p,F as l,T as h,_ as f}from"./index-DIqu7q72.js";import{A as L,D as M}from"./AlertModal-Ccb7kj30.js";import{u as G,z as b,b as k,a as I,t as _,M as z,C as q,I as N}from"./index-DAvzNLjh.js";import{u as E,a as D}from"./axiosInstance-BMsWOdQC.js";import{u as T}from"./useGetAllCompanies-BpHjmJi_.js";import{S as P}from"./Stack-DooxEDXA.js";import{T as v}from"./TextInput-B_fDw_r2.js";import{S as A}from"./Select-D8o9Upw1.js";import{B as j}from"./Button-D4AVOSMh.js";import{I as $}from"./IconEdit-B6zeteLb.js";import{u as U}from"./useGetAllDepartments-B9LbHJOM.js";import{I as W}from"./IconPlus-C5jC-0Y0.js";const K=n=>{const t=F();return E({mutationFn:async r=>{await D.post(`/departments-update/${n}`,r)},onSuccess:()=>{t.invalidateQueries(["departments"])}})},R=n=>G({queryKey:["department",n],queryFn:async()=>await(await D.get(`/departments/${n}`)).data.department,enabled:!!n}),B=b.object({name:b.string().min(1,"name is required"),company_id:b.string().min(1,"company is required")}),V=({id:n})=>{const[t,{open:r,close:c}]=k(!1),{data:o}=R(n),{data:i}=T(),{mutate:u,isPending:y}=K(n),{register:S,handleSubmit:C,setValue:m,control:w,formState:{errors:g}}=I({resolver:_(B)}),d=s=>{const a=new FormData;for(const x in s)a.append(x,s[x]);u(a,{onSuccess:()=>{c(),f.success("Department updated Successfully.")},onError:()=>{f.error("Something went wrong.")}})};return Q.useEffect(()=>{var s;o&&(m("name",o.name),m("company_id",(s=o.company_id)==null?void 0:s.toString()))},[o,m]),e.jsxs(p,{children:[e.jsx(z,{opened:t,onClose:c,title:"Edit Department Form",centered:!0,styles:{title:{fontSize:"20px",fontWeight:600}},children:e.jsx(p,{my:10,children:e.jsxs("form",{onSubmit:C(d),children:[e.jsxs(P,{children:[e.jsxs(l,{align:"center",gap:"lg",children:[e.jsx(h,{w:100,fw:500,children:"Name"}),e.jsx(v,{style:{width:"100%"},placeholder:"Enter department name",...S("name")})]}),e.jsxs(l,{align:"center",gap:"lg",children:[e.jsx(h,{w:100,fw:500,children:"Company"}),e.jsx(q,{name:"company_id",control:w,render:({field:s})=>{var a;return e.jsx(A,{style:{width:"100%"},placeholder:"Pick company",data:i==null?void 0:i.map(x=>({label:x.name,value:x.id.toString()})),...s,error:(a=g.company_id)==null?void 0:a.message})}})]})]}),e.jsxs(l,{justify:"end",gap:15,mt:20,children:[e.jsx(j,{radius:4,size:"sm",onClick:c,color:"dark",children:"Cancel"}),e.jsx(j,{type:"submit",radius:4,size:"sm",loading:y,disabled:y,color:"blue",children:"Update"})]})]})})}),e.jsx($,{onClick:r,style:{color:"#4361ee",cursor:"pointer"}})]})},H=()=>{const n=F();return E({mutationFn:async t=>await D.delete(`/departments-delete/${t}`),onSuccess:()=>{n.invalidateQueries(["departments "])}})},J=({id:n})=>{const[t,{open:r,close:c}]=k(!1),{mutate:o,isPending:i}=H(),u=()=>{o(n,{onSuccess:()=>{c(),f.success("Department deleted successfully.")}})};return e.jsxs(p,{children:[e.jsx(L,{isLoading:i,title:"Department Delete",description:"This action cannot be undone.",opened:t,close:c,onConfirm:u}),e.jsx(N,{onClick:r,style:{color:"#ef233c",cursor:"pointer"}})]})},O=()=>[{name:"Id",selector:t=>t.id,width:"100px"},{name:"Name",selector:t=>t.name,width:"100px"},{name:"Company",selector:t=>t.company.name,width:"450px"},{name:"Actions",cell:t=>e.jsxs(l,{align:"center",gap:20,children:[e.jsx(V,{id:t.id}),e.jsx(J,{id:t.id})]})}],X=()=>{const n=F();return E({mutationFn:async t=>{await D.post("/department-create",t)},onSuccess:()=>{n.invalidateQueries(["departments"])}})},Y=()=>{var g;const[n,{open:t,close:r}]=k(!1),{mutate:c,isPending:o}=X(),{data:i}=T(),{register:u,handleSubmit:y,reset:S,control:C,formState:{errors:m}}=I({resolver:_(B)}),w=d=>{const s=new FormData;for(const a in d)s.append(a,d[a]);c(s,{onSuccess:()=>{S(),r(),f.success("Department created Successfully.")},onError:()=>{f.error("Something went wrong.")}})};return e.jsxs(p,{children:[e.jsx(z,{opened:n,onClose:r,title:"Create Department Form",centered:!0,styles:{title:{fontSize:"20px",fontWeight:600}},children:e.jsx(p,{my:10,children:e.jsxs("form",{onSubmit:y(w),children:[e.jsxs(P,{children:[e.jsxs(l,{align:"center",gap:"lg",children:[e.jsx(h,{w:100,fw:500,children:"Name"}),e.jsx(v,{style:{width:"100%"},placeholder:"Enter department name",...u("name"),error:(g=m.name)==null?void 0:g.message})]}),e.jsxs(l,{align:"center",gap:"lg",children:[e.jsx(h,{w:100,fw:500,children:"Company"}),e.jsx(q,{name:"company_id",control:C,render:({field:d})=>{var s;return e.jsx(A,{style:{width:"100%"},placeholder:"Pick company",data:i==null?void 0:i.map(a=>({label:a.name,value:a.id.toString()})),...d,error:(s=m.company_id)==null?void 0:s.message})}})]})]}),e.jsxs(l,{justify:"end",gap:15,mt:20,children:[e.jsx(j,{radius:4,size:"sm",onClick:r,color:"dark",children:"Cancel"}),e.jsx(j,{type:"submit",radius:4,size:"sm",loading:o,disabled:o,color:"blue",children:"Create"})]})]})})}),e.jsx(l,{justify:"end",children:e.jsx(j,{onClick:t,leftSection:e.jsx(W,{size:16}),children:"Create"})})]})},Z=()=>{const n=O(),{data:t,isLoading:r}=U();return e.jsxs(p,{children:[e.jsx(Y,{}),r?e.jsx(h,{children:"loading..."}):e.jsx(M,{columns:n,data:t})]})},pe=()=>e.jsx(Z,{});export{pe as default};
