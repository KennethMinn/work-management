import{d as B,r as z,j as e,B as F,T as o,F as a,G as R,e as v,_ as k}from"./index-DIqu7q72.js";import{A as ee,D as te}from"./AlertModal-Ccb7kj30.js";import{z as h,u as ne,b as G,a as V,t as $,M as W,C as j,I as re}from"./index-DAvzNLjh.js";import{u as K}from"./useGetAllCustomers-BfXtCVT0.js";import{u as H}from"./useGetAllEmployees-BUtUN7wt.js";import{D as b,d as E,a as se}from"./useGetAllProjects-zGd9NkkP.js";import{u as L,a as U}from"./axiosInstance-BMsWOdQC.js";import{S as J}from"./Stack-DooxEDXA.js";import{F as O,I as X}from"./IconCloudUpload-D9tV3C0-.js";import{B as g}from"./Button-D4AVOSMh.js";import{T as Y}from"./TextInput-B_fDw_r2.js";import{S as N}from"./Select-D8o9Upw1.js";import{I as ae}from"./IconEdit-B6zeteLb.js";import{I as oe}from"./IconPlus-C5jC-0Y0.js";const Z=h.object({name:h.string().min(1,"name is required"),customer_id:h.string().min(1,"customer is required"),description:h.string().min(1,"description is required"),value:h.string().min(1,"value is required"),contract_date:h.date().refine(s=>!isNaN(s.getTime()),"Invalid date"),start_date:h.date().refine(s=>!isNaN(s.getTime()),"Invalid date"),end_date:h.date().refine(s=>!isNaN(s.getTime()),"Invalid date"),user_id:h.string().min(1,"user is required")}),ce=s=>{const t=B();return L({mutationFn:async d=>{await U.post(`/projects-update/${s}`,d)},onSuccess:()=>{t.invalidateQueries(["projects"])}})},ie=s=>ne({queryKey:["project",s],queryFn:async()=>await(await U.get(`/projects/${s}`)).data.project,enabled:!!s}),le=({id:s})=>{var M,r,c;const[t,{open:d,close:w}]=G(!1),{mutate:y,isPending:f}=ce(s),{data:l}=ie(s),{data:p}=K(),{data:P}=H(),[x,q]=z.useState(null),C=z.useRef(null),A=()=>{var n;q(null),(n=C.current)==null||n.call(C)},{register:I,handleSubmit:_,control:u,setValue:m,formState:{errors:S}}=V({resolver:$(Z)}),T=n=>{const i={...n,contract_date:E(n.contract_date).format("YYYY-MM-DD"),start_date:E(n.start_date).format("YYYY-MM-DD"),end_date:E(n.end_date).format("YYYY-MM-DD"),document:x},D=new FormData;for(const Q in i)D.append(Q,i[Q]);y(D,{onSuccess:()=>{w(),k.success("Project Updated Successfully.")},onError:()=>{k.error("Something went wrong.")}})};return z.useEffect(()=>{l&&(m("name",l.name),m("description",l.description),m("value",l.value.toString()),m("customer_id",l.customer_id.toString()),m("user_id",l.user_id.toString()),m("contract_date",new Date(l.contract_date)),m("start_date",new Date(l.start_date)),m("end_date",new Date(l.end_date)))},[l,m]),e.jsxs(F,{children:[e.jsx(W,{size:650,padding:30,opened:t,onClose:w,title:"Edit Project Form",centered:!0,styles:{title:{fontSize:"20px",fontWeight:600}},children:e.jsx(F,{my:10,children:e.jsxs("form",{onSubmit:_(T),children:[e.jsxs(J,{gap:20,children:[x&&e.jsxs(o,{size:"sm",ta:"center",mt:"sm",children:["Picked file: ",x.name]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Document"}),e.jsxs(R,{style:{width:"100%"},children:[e.jsx(O,{resetRef:C,onChange:q,children:n=>e.jsx(g,{leftSection:e.jsx(X,{}),...n,children:"Upload doc"})}),e.jsx(g,{disabled:!x,color:"red",onClick:A,children:"Reset"})]})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Name"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter project name",...I("name"),error:(M=S.name)==null?void 0:M.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Description"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter description name",...I("description"),error:(r=S.description)==null?void 0:r.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Value"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter value",...I("value"),error:(c=S.value)==null?void 0:c.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Customers"}),e.jsx(j,{name:"customer_id",control:u,render:({field:n})=>{var i;return e.jsx(N,{style:{width:"100%"},placeholder:"Pick customer",data:p==null?void 0:p.map(D=>({label:D.name,value:D.id.toString()})),...n,error:(i=S.customer_id)==null?void 0:i.message})}})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Employees"}),e.jsx(j,{name:"user_id",control:u,render:({field:n})=>{var i;return e.jsx(N,{style:{width:"100%"},placeholder:"Pick employee",data:P==null?void 0:P.map(D=>({label:D.name,value:D.id.toString()})),...n,error:(i=S.user_id)==null?void 0:i.message})}})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"Contract Date"}),e.jsx(j,{name:"contract_date",control:u,render:({field:n})=>e.jsx(b,{...n,value:n.value?new Date(n.value):null,onChange:i=>n.onChange(i),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"Start Date"}),e.jsx(j,{name:"start_date",control:u,render:({field:n})=>e.jsx(b,{...n,value:n.value?new Date(n.value):null,onChange:i=>n.onChange(i),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"End Date"}),e.jsx(j,{name:"end_date",control:u,render:({field:n})=>e.jsx(b,{...n,value:n.value?new Date(n.value):null,onChange:i=>n.onChange(i),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]})]}),e.jsxs(a,{justify:"end",gap:15,mt:20,children:[e.jsx(g,{radius:4,size:"sm",onClick:w,color:"dark",children:"Cancel"}),e.jsx(g,{type:"submit",radius:4,size:"sm",loading:f,disabled:f,color:"blue",children:"Create"})]})]})})}),e.jsx(ae,{onClick:d,style:{color:"#4361ee",cursor:"pointer"}})]})},de=()=>{const s=B();return L({mutationFn:async t=>await U.delete(`/projects-delete/${t}`),onSuccess:()=>{s.invalidateQueries(["projects "])}})},ue=({id:s})=>{const[t,{open:d,close:w}]=G(!1),{mutate:y,isPending:f}=de(),l=()=>{y(s,{onSuccess:()=>{w(),k.success("Project deleted successfully.")}})};return e.jsxs(F,{children:[e.jsx(ee,{isLoading:f,title:"Project Delete",description:"This action cannot be undone.",opened:t,close:w,onConfirm:l}),e.jsx(re,{onClick:d,style:{color:"#ef233c",cursor:"pointer"}})]})},me=()=>[{name:"Id",selector:t=>t.id,width:"50px"},{name:"Name",selector:t=>t.name,width:"100px"},{name:"Description",selector:t=>t.description,width:"140px"},{name:"Customer",selector:t=>t.customer.name,width:"100px"},{name:"User",selector:t=>t.employee.name,width:"150px"},{name:"Value",selector:t=>t.value,width:"100px"},{name:"Contract Date",selector:t=>t.contract_date,width:"130px"},{name:"Start Date",selector:t=>t.start_date,width:"130px"},{name:"End Date",selector:t=>t.end_date,width:"130px"},{name:"Doc",cell:t=>e.jsx(o,{onClick:()=>window.open(t.fileURL,"_blank"),style:{textDecoration:"underline",cursor:"pointer"},c:"blue",children:"doc"}),width:"100px"},{name:"Actions",cell:t=>e.jsxs(a,{align:"center",gap:20,children:[e.jsx(le,{id:t.id}),e.jsx(ue,{id:t.id})]})}],je=()=>{const s=B();return L({mutationFn:async t=>{await U.post("/project-create",t)},onSuccess:()=>{s.invalidateQueries(["projects"])}})},pe=()=>{var S,T,M;const[s,{open:t,close:d}]=G(!1),{mutate:w,isPending:y}=je(),{data:f}=K(),{data:l}=H(),[p,P]=z.useState(null),x=z.useRef(null),q=()=>{var r;P(null),(r=x.current)==null||r.call(x)},{register:C,handleSubmit:A,reset:I,control:_,formState:{errors:u}}=V({resolver:$(Z)}),m=r=>{if(!p){k.error("Please add document");return}const c={...r,contract_date:E(r.contract_date).format("YYYY-MM-DD"),start_date:E(r.start_date).format("YYYY-MM-DD"),end_date:E(r.end_date).format("YYYY-MM-DD"),document:p},n=new FormData;for(const i in c)n.append(i,c[i]);w(n,{onSuccess:()=>{I(),d(),k.success("Project Created Successfully.")},onError:()=>{k.error("Something went wrong.")}})};return e.jsxs(F,{children:[e.jsx(W,{size:650,padding:30,opened:s,onClose:d,title:"Create Project Form",centered:!0,styles:{title:{fontSize:"20px",fontWeight:600}},children:e.jsx(F,{my:10,children:e.jsxs("form",{onSubmit:A(m),children:[e.jsxs(J,{gap:20,children:[p&&e.jsxs(o,{size:"sm",ta:"center",mt:"sm",children:["Picked file: ",p.name]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Document"}),e.jsxs(R,{style:{width:"100%"},children:[e.jsx(O,{resetRef:x,onChange:P,children:r=>e.jsx(g,{leftSection:e.jsx(X,{}),...r,children:"Upload doc"})}),e.jsx(g,{disabled:!p,color:"red",onClick:q,children:"Reset"})]})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Name"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter project name",...C("name"),error:(S=u.name)==null?void 0:S.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Description"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter description name",...C("description"),error:(T=u.description)==null?void 0:T.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Value"}),e.jsx(Y,{style:{width:"100%"},placeholder:"Enter value",...C("value"),error:(M=u.value)==null?void 0:M.message})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Customers"}),e.jsx(j,{name:"customer_id",control:_,render:({field:r})=>{var c;return e.jsx(N,{style:{width:"100%"},placeholder:"Pick customer",data:f==null?void 0:f.map(n=>({label:n.name,value:n.id.toString()})),...r,error:(c=u.customer_id)==null?void 0:c.message})}})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:170,fw:500,children:"Employees"}),e.jsx(j,{name:"user_id",control:_,render:({field:r})=>{var c;return e.jsx(N,{style:{width:"100%"},placeholder:"Pick employee",data:l==null?void 0:l.map(n=>({label:n.name,value:n.id.toString()})),...r,error:(c=u.user_id)==null?void 0:c.message})}})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"Contract Date"}),e.jsx(j,{name:"contract_date",control:_,render:({field:r})=>e.jsx(b,{...r,value:r.value?new Date(r.value):null,onChange:c=>r.onChange(c),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"Start Date"}),e.jsx(j,{name:"start_date",control:_,render:({field:r})=>e.jsx(b,{...r,value:r.value?new Date(r.value):null,onChange:c=>r.onChange(c),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]}),e.jsxs(a,{align:"center",gap:"lg",children:[e.jsx(o,{w:130,fw:500,children:"End Date"}),e.jsx(j,{name:"end_date",control:_,render:({field:r})=>e.jsx(b,{...r,value:r.value?new Date(r.value):null,onChange:c=>r.onChange(c),leftSection:e.jsx(v,{}),leftSectionPointerEvents:"none",placeholder:"Pick date"})})]})]}),e.jsxs(a,{justify:"end",gap:15,mt:20,children:[e.jsx(g,{radius:4,size:"sm",onClick:d,color:"dark",children:"Cancel"}),e.jsx(g,{type:"submit",radius:4,size:"sm",loading:y,disabled:y,color:"blue",children:"Create"})]})]})})}),e.jsx(a,{justify:"end",children:e.jsx(g,{onClick:t,leftSection:e.jsx(oe,{size:16}),children:"Create"})})]})},xe=()=>{const s=me(),{data:t,isLoading:d}=se();return e.jsxs(F,{children:[e.jsx(pe,{}),d?e.jsx("div",{children:"table"}):e.jsx(te,{columns:s,data:t})]})},Ye=()=>e.jsx(xe,{});export{Ye as default};
